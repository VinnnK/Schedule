<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
    
    <title>ì°¸ì—¬ì‹œê°„</title>
    <style>
      body {
        font-family: sans-serif;
        padding: 1rem;
        max-width: 800px;
        margin: auto;
        overflow-x: hidden;
      }
      input, button, select {
        appearance: none;
        width: 100%;
        padding: 0.5rem;
        margin-bottom: 1rem;
        border-radius: 6px;
        border: 1px solid #ccc;
        font-size: 1rem;
	box-sizing: border-box; 
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 1rem;
        user-select: none;
      }
      th, td {
        border: 1px solid #ccc;
        padding: 0.5rem;
        text-align: center;
        touch-action: manipulation;
      }
      td.hour-cell {
        cursor: pointer;
        background-color: #f0f0f0;
        transition: background-color 0.2s;
        min-width: 60px;
      }
      td.selected-current {
        background-color: #22c55e !important;
        color: white !important;
      }
      td[data-count="1"]:not(.selected-current) { background-color: #dbeafe; }
      td[data-count="2"]:not(.selected-current) { background-color: #bfdbfe; }
      td[data-count="3"]:not(.selected-current) { background-color: #93c5fd; }
      td[data-count="4"]:not(.selected-current) { background-color: #60a5fa; color: white; }
      td[data-count]:not(.selected-current)[data-count]:is([data-count="5"], [data-count="6"], [data-count="7"], [data-count="8"], [data-count="9"], [data-count="10"], [data-count="11"], [data-count="12"], [data-count="13"], [data-count="14"], [data-count="15"], [data-count="16"], [data-count="17"], [data-count="18"], [data-count="19"], [data-count="20"]) { background-color: #3b82f6; color: white; }

      .message {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        color: white;
        padding: 0.75rem 1.25rem;
        border-radius: 6px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        z-index: 999;
        display: none;
        font-weight: bold;
      }
      .message.success { background-color: #22c55e; }
      .message.error { background-color: #ef4444; }

      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .small-buttons {
        display: flex;
        gap: 0.5rem;
      }
      .small-buttons button {
        width: auto;
        padding: 0.3rem 0.6rem;
        font-size: 0.9rem;
        margin-bottom: 0;
      }
    </style>
  </head>
  <body>

<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyA-U74_QfN7CanKwDOpyM97KYN7Jromiy4",
    authDomain: "schedule-da078.firebaseapp.com",
    databaseURL: "https://schedule-da078-default-rtdb.firebaseio.com",
    projectId: "schedule-da078",
    storageBucket: "schedule-da078.firebasestorage.app",
    messagingSenderId: "480800174812",
    appId: "1:480800174812:web:4b11969665249be810fa19"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
</script>

    <div class="header">
      <h1>ì°¸ì—¬ì‹œê°„</h1>
      <div class="small-buttons">
        <button onclick="selectAllHours()">ì „ì²´ ì„ íƒ</button>
        <button onclick="clearAllHours()">ì„ íƒ ì·¨ì†Œ</button>
      </div>
    </div>

    <table>
      <thead>
        <tr><th>ì‹œê°„</th><th>ì°¸ì—¬ ì¸ì›</th></tr>
      </thead>
      <tbody id="time-table"></tbody>
    </table>

    <input type="text" id="nickname" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" />
    <div class="message" id="message"></div>
    <button onclick="saveSchedule()">ì‹œê°„ ì €ì¥í•˜ê¸°</button>
    <button onclick="deleteSchedule()">í•´ë‹¹ ì°¸ì—¬ì ì‚­ì œí•˜ê¸°</button>
    <button onclick="deleteAllSchedules()" style="background-color:black; border-color:gray; color:white" >ëª¨ë“  ì°¸ì—¬ì ê¸°ë¡ ì‚­ì œí•˜ê¸°</button>
    
    <h2>ì‹œê°„ë³„ ì°¸ì—¬ì í™•ì¸</h2>
    <select id="hour-select">
      <option value="">ì‹œê°„ì„ ì„ íƒí•˜ì„¸ìš”</option>
    </select>
    <ul id="hour-participants"></ul>

<h2>ì „ì²´ ì°¸ì—¬ì ëª©ë¡ <span id="all-participants-count">(0ëª…)</span></h2>
<ul id="all-participants"></ul>

    <script>
      const HOURS = Array.from({ length: 24 }, (_, i) => (i + 7) % 24);
      const schedule = {};
      let currentUserSchedule = [];

      const table = document.getElementById("time-table");
      const hourSelect = document.getElementById("hour-select");
      const participantList = document.getElementById("hour-participants");
      const messageBox = document.getElementById("message");

      function showMessage(text, type = 'success') {
        messageBox.innerText = text;
        messageBox.className = `message ${type}`;
        messageBox.style.display = 'block';
        setTimeout(() => messageBox.style.display = 'none', 2000);
      }

      function renderTable() {
        table.innerHTML = "";
        HOURS.forEach((hour) => {
          const tr = document.createElement("tr");

          const th = document.createElement("th");
          th.textContent = `${hour.toString().padStart(2, '0')}:00`;

          const td = document.createElement("td");
          const participants = getHourParticipants(hour);
          td.className = "hour-cell";
          td.dataset.count = participants.length;
          td.innerText = participants.length;

          if (currentUserSchedule.includes(hour)) {
            td.classList.add("selected-current");
          }
          td.title = participants.join(", ");
          td.addEventListener('click', () => toggleHour(hour));

          tr.appendChild(th);
          tr.appendChild(td);
          table.appendChild(tr);
        });
      }

      function renderHourSelect() {
        hourSelect.innerHTML = '<option value="">ì‹œê°„ì„ ì„ íƒí•˜ì„¸ìš”</option>';
        HOURS.forEach(hour => {
          const option = document.createElement("option");
          option.value = hour;
          option.textContent = `${hour.toString().padStart(2, '0')}:00`;
          hourSelect.appendChild(option);
        });
      }

      function renderParticipants(hour) {
        participantList.innerHTML = "";
        const names = getHourParticipants(hour);
        if (names.length === 0) {
          const li = document.createElement("li");
          li.textContent = "ì°¸ì—¬ìê°€ ì—†ìŠµë‹ˆë‹¤.";
          participantList.appendChild(li);
        } else {
          names.forEach(name => {
            const li = document.createElement("li");
            li.textContent = name;
            participantList.appendChild(li);
          });
        }
      }

      function toggleHour(hour) {
        if (currentUserSchedule.includes(hour)) {
          currentUserSchedule = currentUserSchedule.filter(h => h !== hour);
        } else {
          currentUserSchedule.push(hour);
        }
        renderTable();
      }

      function getHourParticipants(hour) {
        return Object.entries(schedule)
          .filter(([_, hours]) => hours.includes(hour))
          .map(([name]) => name);
      }

      function saveSchedule() {
        const name = document.getElementById("nickname").value.trim();
        if (!name) {
          showMessage("ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”.", "error");
          return;
        }
        if (schedule[name]) {
          showMessage("ì´ë¯¸ ë“±ë¡ëœ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤. ì‚­ì œ í›„ ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”.", "error");
          return;
        }
        if (currentUserSchedule.length === 0) {
          showMessage("ì‹œê°„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.", "error");
          return;
        }
        schedule[name] = currentUserSchedule;
        currentUserSchedule = [];
        document.getElementById("nickname").value = "";
        renderTable();
        showMessage("ì¼ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
renderAllParticipants();
      }

      function deleteSchedule() {
        const name = document.getElementById("nickname").value.trim();
        if (!name || !schedule[name]) {
          showMessage("í•´ë‹¹ ë‹‰ë„¤ì„ì˜ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.", "error");
          return;
        }
        delete schedule[name];
        currentUserSchedule = [];
        document.getElementById("nickname").value = "";
        renderTable();
        showMessage("ì¼ì •ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
renderAllParticipants();
      }

      function deleteAllSchedules() {
        if (confirm("ëª¨ë“  ì…ë ¥ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
          Object.keys(schedule).forEach(key => delete schedule[key]);
          currentUserSchedule = [];
          renderTable();
          showMessage("ëª¨ë“  ì¼ì •ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
renderAllParticipants();
        }
      }

      function selectAllHours() {
        currentUserSchedule = [...HOURS];
        renderTable();
      }

      function clearAllHours() {
        currentUserSchedule = [];
        renderTable();
      }

      hourSelect.addEventListener("change", (e) => {
        const val = e.target.value;
        if (val !== "") renderParticipants(Number(val));
        else participantList.innerHTML = "";
      });

function formatHourRanges(hours) {
  if (hours.length === 0) return "";

  const sorted = [...hours].sort((a, b) => {
    const shift = h => (h < 7 ? h + 24 : h);  // 7ì‹œ ê¸°ì¤€ ì •ë ¬
    return shift(a) - shift(b);
  });

  const ranges = [];
  let start = sorted[0];
  let end = sorted[0];

  for (let i = 1; i < sorted.length; i++) {
    const expected = (end + 1) % 24;
    if (sorted[i] === expected) {
      end = sorted[i];
    } else {
      ranges.push([start, end]);
      start = sorted[i];
      end = sorted[i];
    }
  }
  ranges.push([start, end]);

return ranges.map(([s, e]) => {
  // ì¢…ë£Œì‹œê°„ì€ ëˆ„ë¥¸ ì‹œê°„ë³´ë‹¤ 1ì‹œê°„ ë’¤
  const end = (e + 1) % 24;
  // ì‹œì‘ê³¼ ì¢…ë£Œ ì‹œê°„ì´ ëª¨ë‘ 7ì‹œì¸ ê²½ìš° í•˜ë£¨ì¢…ì¼ë¡œ ì²˜ë¦¬
  if (s === 7 && end === 7) {
    return "í•˜ë£¨ì¢…ì¼";}
  const startLabel = (s >= 0 && s <= 6) ? `ìƒˆë²½ ${s}ì‹œ` : `${s}ì‹œ`;
  const endLabel = (end >= 0 && end <= 6) ? `ìƒˆë²½ ${end}ì‹œ` : `${end}ì‹œ`;
  return `${startLabel}~${endLabel}`;
}).join(", ");
}

function renderAllParticipants() {
  const container = document.getElementById("all-participants");
  container.innerHTML = "";

  const names = Object.keys(schedule);

  if (names.length === 0) {
    const li = document.createElement("li");
    li.textContent = "ë“±ë¡ëœ ì°¸ì—¬ìê°€ ì—†ìŠµë‹ˆë‹¤.";
    container.appendChild(li);
    return;
  }

  names.forEach(name => {
    const li = document.createElement("li");
    const timeRanges = formatHourRanges(schedule[name]);
    li.textContent = `${name} â€“ ${timeRanges}`;
    container.appendChild(li);
  });

function renderAllParticipants() {
  const container = document.getElementById("all-participants");
  container.innerHTML = "";

  const names = Object.keys(schedule);
  if (names.length === 0) {
    const li = document.createElement("li");
    li.textContent = "ë“±ë¡ëœ ì°¸ì—¬ìê°€ ì—†ìŠµë‹ˆë‹¤.";
    container.appendChild(li);

    // ğŸ‘‡ ì¶”ê°€ëœ ì½”ë“œ: ì¸ì› ìˆ˜ 0ìœ¼ë¡œ ì—…ë°ì´íŠ¸
    document.getElementById("participant-count").textContent = `(0ëª…)`;
    return;
  }

  names.forEach(name => {
    const li = document.createElement("li");
    const timeRanges = formatHourRanges(schedule[name]);
    li.textContent = `${name} â€“ ${timeRanges}`;
    container.appendChild(li);
  });

  // ğŸ‘‡ ì¶”ê°€ëœ ì½”ë“œ: ì°¸ì—¬ì ìˆ˜ ë°˜ì˜
  document.getElementById("participant-count").textContent = `(${names.length}ëª…)`;
}

}


      renderTable();
      renderHourSelect();
renderAllParticipants();
    </script>
  </body>
</html>
