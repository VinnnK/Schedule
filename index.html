<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>모임 시간표</title>
    <style>
      body {
        font-family: sans-serif;
        padding: 1rem;
        max-width: 800px;
        margin: auto;
        overflow-x: hidden;
      }
      input, button, select {
        width: 100%;
        padding: 0.5rem;
        margin-bottom: 1rem;
        border-radius: 6px;
        border: 1px solid #ccc;
        font-size: 1rem;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 1rem;
        user-select: none;
      }
      th, td {
        border: 1px solid #ccc;
        padding: 0.5rem;
        text-align: center;
        touch-action: manipulation;
      }
      td.hour-cell {
        cursor: pointer;
        background-color: #f0f0f0;
        transition: background-color 0.2s;
        min-width: 60px;
      }
      td.selected-current {
        background-color: #22c55e !important;
        color: white !important;
      }
      td[data-count="1"]:not(.selected-current) { background-color: #dbeafe; }
      td[data-count="2"]:not(.selected-current) { background-color: #bfdbfe; }
      td[data-count="3"]:not(.selected-current) { background-color: #93c5fd; }
      td[data-count="4"]:not(.selected-current) { background-color: #60a5fa; color: white; }
      td[data-count="5"]:not(.selected-current) { background-color: #3b82f6; color: white; }
      .message {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        color: white;
        padding: 0.75rem 1.25rem;
        border-radius: 6px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        z-index: 999;
        display: none;
        font-weight: bold;
      }
      .message.success {
        background-color: #22c55e;
      }
      .message.error {
        background-color: #ef4444;
      }
    </style>
  </head>
  <body>
    <h1>모임 시간표</h1>
    <input type="text" id="nickname" placeholder="닉네임을 입력하세요" />
    <div class="message" id="message"></div>
    <table>
      <thead>
        <tr><th>시간</th><th>참여 인원</th></tr>
      </thead>
      <tbody id="time-table"></tbody>
    </table>
    <button onclick="saveSchedule()">시간 저장하기</button>
    <button onclick="deleteSchedule()">입력 삭제하기</button>
    <button onclick="deleteAllSchedules()">모든 입력 삭제하기</button>

    <h2>참여자 확인</h2>
    <select id="hour-select">
      <option value="">시간을 선택하세요</option>
    </select>
    <ul id="hour-participants"></ul>

    <script>
      const HOURS = Array.from({ length: 24 }, (_, i) => i);
      const schedule = {};
      let currentUserSchedule = [];
      let isMouseDown = false;

      const table = document.getElementById("time-table");
      const hourSelect = document.getElementById("hour-select");
      const participantList = document.getElementById("hour-participants");
      const messageBox = document.getElementById("message");

      function showMessage(text, type = 'success') {
        messageBox.innerText = text;
        messageBox.className = `message ${type}`;
        messageBox.style.display = 'block';
        setTimeout(() => messageBox.style.display = 'none', 2000);
      }

      function renderTable() {
        table.innerHTML = "";
        HOURS.forEach((hour) => {
          const tr = document.createElement("tr");

          const th = document.createElement("th");
          th.textContent = `${hour}:00`;

          const td = document.createElement("td");
          const participants = getHourParticipants(hour);
          td.className = "hour-cell";
          td.dataset.count = participants.length;
          td.innerText = participants.length;

          if (currentUserSchedule.includes(hour)) {
            td.classList.add("selected-current");
          }
          td.title = participants.join(", ");

          td.addEventListener('mousedown', (e) => {
            e.preventDefault();
            isMouseDown = true;
            toggleHour(hour);
          });

          td.addEventListener('mouseenter', (e) => {
            if (isMouseDown) {
              e.preventDefault();
              toggleHour(hour);
            }
          });

          tr.appendChild(th);
          tr.appendChild(td);
          table.appendChild(tr);
        });
      }

      document.body.addEventListener("mouseup", () => isMouseDown = false);

      function renderHourSelect() {
        hourSelect.innerHTML = '<option value="">시간을 선택하세요</option>';
        HOURS.forEach(hour => {
          const option = document.createElement("option");
          option.value = hour;
          option.textContent = `${hour}:00`;
          hourSelect.appendChild(option);
        });
      }

      function renderParticipants(hour) {
        participantList.innerHTML = "";
        const names = getHourParticipants(hour);
        if (names.length === 0) {
          const li = document.createElement("li");
          li.textContent = "참여자가 없습니다.";
          participantList.appendChild(li);
        } else {
          names.forEach(name => {
            const li = document.createElement("li");
            li.textContent = name;
            participantList.appendChild(li);
          });
        }
      }

      function toggleHour(hour) {
        if (currentUserSchedule.includes(hour)) {
          currentUserSchedule = currentUserSchedule.filter(h => h !== hour);
        } else {
          currentUserSchedule.push(hour);
        }
        renderTable();
      }

      function getHourParticipants(hour) {
        return Object.entries(schedule)
          .filter(([_, hours]) => hours.includes(hour))
          .map(([name]) => name);
      }

      function saveSchedule() {
        const name = document.getElementById("nickname").value.trim();
        if (!name) {
          showMessage("닉네임을 입력하세요.", "error");
          return;
        }

        if (schedule[name]) {
          showMessage("이미 등록된 닉네임입니다. 삭제 후 다시 입력해주세요.", "error");
          return;
        }

        if (currentUserSchedule.length === 0) {
          showMessage("시간을 선택해주세요.", "error");
          return;
        }

        schedule[name] = currentUserSchedule;
        currentUserSchedule = [];
        document.getElementById("nickname").value = "";
        renderTable();
        showMessage("일정이 저장되었습니다.");
      }

      function deleteSchedule() {
        const name = document.getElementById("nickname").value.trim();
        if (!name || !schedule[name]) {
          showMessage("해당 닉네임의 데이터가 없습니다.", "error");
          return;
        }
        delete schedule[name];
        currentUserSchedule = [];
        document.getElementById("nickname").value = "";
        renderTable();
        showMessage("일정이 삭제되었습니다.");
      }

      function deleteAllSchedules() {
        if (confirm("모든 입력을 삭제하시겠습니까?")) {
          Object.keys(schedule).forEach(key => delete schedule[key]);
          currentUserSchedule = [];
          renderTable();
          showMessage("모든 일정이 삭제되었습니다.");
        }
      }

      hourSelect.addEventListener("change", (e) => {
        const val = e.target.value;
        if (val !== "") renderParticipants(Number(val));
        else participantList.innerHTML = "";
      });

      renderTable();
      renderHourSelect();
    </script>
  </body>
</html>
